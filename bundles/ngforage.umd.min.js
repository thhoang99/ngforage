!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("localforage"),require("@angular/core")):"function"==typeof define&&define.amd?define("ngforage",["exports","localforage","@angular/core"],t):t(e.ngforage={},e.localforage,e.ng.core)}(this,function(e,t,n){"use strict";var r="default"in t?t["default"]:t;function i(e,t){Object.defineProperty(e.prototype,Symbol.toStringTag,{configurable:!1,enumerable:!1,value:t||e.name,writable:!1})}var o=function(){function e(e,t){this.data=e,this.expires=new Date("number"==typeof t?t:0)}return Object.defineProperty(e.prototype,"expired",{get:function(){var e=0===this.expiresIn;return e&&Object.defineProperty(this,"expired",{value:e}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expiresIn",{get:function(){var e=Math.max(0,this.expires.getTime()-Date.now());return e||Object.defineProperty(this,"expiresIn",{value:e}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasData",{get:function(){var e=null!=this.data;return Object.defineProperty(this,"hasData",{value:e}),e},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{data:this.data,expired:this.expired,expires:this.expires,expiresIn:this.expiresIn,hasData:this.hasData}},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();i(o,"CachedItem");var c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function s(e,t){function r(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var a,u,f="defineDriver"in t?t:r,p={INDEXED_DB:f.INDEXEDDB,LOCAL_STORAGE:f.LOCALSTORAGE,WEB_SQL:f.WEBSQL};try{for(var g=function A(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}([f.INDEXEDDB,f.LOCALSTORAGE,f.WEBSQL]),h=g.next();!h.done;h=g.next()){var l=h.value;delete p[l]}}catch(L){a={error:L}}finally{try{h&&!h.done&&(u=g["return"])&&u.call(g)}finally{if(a)throw a.error}}Object.freeze(p);var d=new n.InjectionToken("Default NgForage config"),y=Symbol("Default Config"),b=function(){function e(e){this[y]={cacheTime:3e5,description:"",driver:[p.INDEXED_DB,p.WEB_SQL,p.LOCAL_STORAGE],name:"ngForage",size:4980736,storeName:"ng_forage",version:1},e&&this.configure(e)}return Object.defineProperty(e.prototype,"cacheTime",{get:function(){return this[y].cacheTime},set:function(e){this[y].cacheTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return{cacheTime:this.cacheTime,description:this.description,driver:this.driver,name:this.name,size:this.size,storeName:this.storeName,version:this.version}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this[y].description},set:function(e){this[y].description=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driver",{get:function(){return"string"==typeof this[y].driver?this[y].driver:this[y].driver.slice()},set:function(e){this[y].driver=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this[y].name},set:function(e){this[y].name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this[y].size},set:function(e){this[y].size=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeName",{get:function(){return this[y].storeName},set:function(e){this[y].storeName=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this[y].version},set:function(e){this[y].version=e},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return(e=e||{}).driver&&e.driver.slice&&(e.driver=e.driver.slice()),Object.assign(this[y],e),this},e.prototype.defineDriver=function(e){return f.defineDriver(e)},e.prototype.toJSON=function(){return this.config},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[d]}]}]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(d,8))},token:e,providedIn:"root"}),e}();i(b);var m={};function v(e){return[function t(e){return e?Array.isArray(e)?e.slice().sort().join(","):e:""}(e.driver),e.name,e.size,e.storeName,e.version,e.description,e.cacheTime].join("|")}var j=Symbol("Config"),O=function(){function e(e){this[j]=e}return e.prototype.getInstance=function(e){var t=v(e=Object.assign({},this[j].config,e||{}));return m[t]||(m[t]=f.createInstance(e)),m[t]},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:b}]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(b))},token:e,providedIn:"root"}),e}();i(O);var I=Symbol("Store"),N=function(){function e(e,t){this.config={},this.baseConfig=e,this.fact=t}return Object.defineProperty(e.prototype,"description",{get:function(){return this.config.description||this.baseConfig.description},set:function(e){this.config.description=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driver",{get:function(){return this.config.driver||this.baseConfig.driver},set:function(e){this.config.driver=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.config.name||this.baseConfig.name},set:function(e){this.config.name=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.config.size||this.baseConfig.size},set:function(e){this.config.size=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeName",{get:function(){return this.config.storeName||this.baseConfig.storeName},set:function(e){this.config.storeName=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return"version"in this.config?this.config.version:this.baseConfig.version},set:function(e){this.config.version=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"finalConfig",{get:function(){return Object.assign({},this.baseConfig.config,this.config)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"store",{get:function(){return!this.storeNeedsRecalc&&this[I]||(this[I]=this.fact.getInstance(this.finalConfig),this.storeNeedsRecalc=!1),this[I]},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){return e=e||{},Array.isArray(e.driver)&&(e.driver=e.driver.slice()),Object.assign(this.config,e),this.storeNeedsRecalc=!0,this},e.prototype.toJSON=function(){return{description:this.description,driver:this.driver,name:this.name,size:this.size,storeName:this.storeName,version:this.version}},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.ctorParameters=function(){return[{type:b,decorators:[{type:n.Inject,args:[b]}]},{type:O,decorators:[{type:n.Inject,args:[O]}]}]},e}();i(N,"BaseConfigurable"),Object.defineProperty(N,"storeNeedsRecalc",{configurable:!0,enumerable:!0,value:!0,writable:!0});var C=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return s(r,e),Object.defineProperty(r.prototype,"activeDriver",{get:function(){return this.store.driver()},enumerable:!0,configurable:!0}),r.prototype.clear=function(){return this.store.clear()},r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r.prototype.getItem=function(e){return this.store.getItem(e)},r.prototype.iterate=function(e){return this.store.iterate(e)},r.prototype.key=function(e){return this.store.key(e)},r.prototype.keys=function(){return this.store.keys()},r.prototype.length=function(){return this.store.length()},r.prototype.ready=function(){return this.store.ready()},r.prototype.removeItem=function(e){return this.store.removeItem(e)},r.prototype.setItem=function(e,t){return this.store.setItem(e,t)},r.prototype.supports=function(e){return this.store.supports(e)},r.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],r.ngInjectableDef=n.defineInjectable({factory:function(){return new r(n.inject(b),n.inject(O))},token:r,providedIn:"root"}),r}(N);function P(e){return{data:e+"_data",expiry:e+"_expiry"}}function D(e){return new o(e[0],e[1])}function S(e){return e[0]}function x(){}i(C);var T=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return s(r,t),Object.defineProperty(r.prototype,"cacheTime",{get:function(){return this.config.cacheTime||this.baseConfig.cacheTime},set:function(e){this.config.cacheTime=e,this.storeNeedsRecalc=!0},enumerable:!0,configurable:!0}),r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r.prototype.getCached=function(e){var t=P(e),r=this.getItem(t.data),n=this.getItem(t.expiry);return Promise.all([r,n]).then(D)},r.prototype.removeCached=function(e){var t=P(e),r=this.removeItem(t.data),n=this.removeItem(t.expiry);return Promise.all([r,n]).then(x)},r.prototype.setCached=function(e,t,r){var n=P(e),i="number"==typeof r?r:this.cacheTime,o=this.setItem(n.data,t),c=this.setItem(n.expiry,Date.now()+i);return Promise.all([o,c]).then(S)},r.prototype.toJSON=function(){var e={cacheTime:this.cacheTime};return Object.assign(t.prototype.toJSON.call(this),e)},r.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],r.ngInjectableDef=n.defineInjectable({factory:function(){return new r(n.inject(b),n.inject(O))},token:r,providedIn:"root"}),r}(C);i(T);var w=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return s(r,e),r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r}(T);i(w,"NgForageCache (dedicated)");var _=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return s(r,e),r.prototype.clone=function(e){var t=new r(this.baseConfig,this.fact);return t.configure(Object.assign(this.finalConfig,e||{})),t},r}(C);i(_,"NgForage (dedicated)");var E=Symbol("NgForageConfig"),F=Symbol("InstanceFactory"),R=function(){function e(e,t){this[E]=e,this[F]=t}return e.prototype.createCache=function(e){var t=new w(this[E],this[F]);return e&&t.configure(e),t},e.prototype.createNgForage=function(e){var t=new _(this[E],this[F]);return e&&t.configure(e),t},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:b},{type:O}]},e.ngInjectableDef=n.defineInjectable({factory:function(){return new e(n.inject(b),n.inject(O))},token:e,providedIn:"root"}),e}();i(R);var z=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:d,useValue:e?Object.assign({},e):{}}]}},t.decorators=[{type:n.NgModule,args:[{}]}],t}();e.DEFAULT_CONFIG=d,e.CachedItemImpl=o,e.NgForageCache=T,e.BaseConfigurableImpl=N,e.NgForageConfig=b,e.DedicatedInstanceFactory=R,e.NgForageCacheDedicated=w,e.NgForageDedicated=_,e.InstanceFactory=O,e.NgForage=C,e.NgForageModule=z,e.Driver=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngforage.umd.min.js.map